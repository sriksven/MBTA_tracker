name: Daily Auto Commits

on:
  schedule:
    # Run at random times throughout the day (multiple times to spread commits)
    - cron: '0 6 * * *'   # 6 AM UTC
    - cron: '0 9 * * *'   # 9 AM UTC
    - cron: '0 12 * * *'  # 12 PM UTC
    - cron: '0 15 * * *'  # 3 PM UTC
    - cron: '0 18 * * *'  # 6 PM UTC
    - cron: '0 21 * * *'  # 9 PM UTC
  workflow_dispatch: # Allow manual trigger

jobs:
  auto-commit:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: Create Random Commits
        run: |
          # Array of meaningful commit messages
          commit_messages=(
            "Update route calculation algorithm"
            "Improve error handling for API requests"
            "Refactor stop data fetching logic"
            "Optimize map rendering performance"
            "Add caching for frequently accessed routes"
            "Fix timezone handling in schedule display"
            "Update dependencies to latest versions"
            "Improve accessibility for screen readers"
            "Refactor nearby stops calculation"
            "Add unit tests for route service"
            "Update documentation for API endpoints"
            "Improve loading state animations"
            "Fix memory leak in map component"
            "Optimize bundle size"
            "Add error boundary for map view"
            "Improve geolocation accuracy"
            "Update color scheme for better contrast"
            "Refactor state management logic"
            "Add analytics tracking events"
            "Improve mobile responsiveness"
            "Fix race condition in data fetching"
            "Update transit line colors"
            "Improve search functionality"
            "Add keyboard navigation support"
            "Optimize image loading"
            "Fix layout issues on small screens"
            "Update API request retry logic"
            "Improve code documentation"
            "Refactor component structure"
            "Add performance monitoring"
            "Update error messages for clarity"
            "Improve data validation logic"
            "Add loading skeletons for better UX"
            "Fix edge cases in route planning"
            "Update map marker icons"
            "Improve network error handling"
            "Refactor utility functions"
            "Add integration tests"
            "Update README documentation"
            "Improve code formatting"
            "Fix accessibility issues"
            "Update service worker cache strategy"
            "Improve offline functionality"
            "Add user preference persistence"
            "Update API response parsing"
            "Improve animation performance"
            "Fix cross-browser compatibility issues"
            "Update build configuration"
            "Improve type definitions"
            "Add ESLint rules for consistency"
          )
          
          # Determine if we should create commits (70% chance to avoid too many commits)
          if [ $((RANDOM % 10)) -lt 7 ]; then
            # Random number of commits between 1 and 4 per run (total 1-15 per day across runs)
            num_commits=$((1 + RANDOM % 4))
            
            echo "Creating $num_commits commit(s)..."
            
            for ((i=1; i<=num_commits; i++)); do
              # Get random commit message
              random_index=$((RANDOM % ${#commit_messages[@]}))
              message="${commit_messages[$random_index]}"
              
              # Create empty commit with meaningful message
              git commit --allow-empty -m "$message"
              
              echo "✓ Created commit: $message"
              
              # Immediately push after each commit
              git push origin main
              echo "✓ Pushed commit to GitHub"
              
              # Random delay between commits (10-300 seconds)
              if [ $i -lt $num_commits ]; then
                sleep_time=$((10 + RANDOM % 290))
                echo "Waiting ${sleep_time} seconds before next commit..."
                sleep $sleep_time
              fi
            done
            
            echo "All commits created and pushed successfully!"
          else
            echo "Skipping commits this run to maintain natural activity pattern"
          fi
      
      - name: Verify Push
        run: |
          echo "Latest commits:"
          git log --oneline -n 5
