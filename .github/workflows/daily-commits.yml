name: Daily Auto Commits

on:
  schedule:
    # Run at random times throughout the day (12 potential times)
    # Combined with 70% skip probability = ~3-5 actual runs per day with natural variance
    - cron: '17 5 * * *'   # 5:17 AM UTC
    - cron: '43 7 * * *'   # 7:43 AM UTC
    - cron: '28 9 * * *'   # 9:28 AM UTC
    - cron: '52 10 * * *'  # 10:52 AM UTC
    - cron: '09 12 * * *'  # 12:09 PM UTC
    - cron: '34 14 * * *'  # 2:34 PM UTC
    - cron: '21 16 * * *'  # 4:21 PM UTC
    - cron: '47 17 * * *'  # 5:47 PM UTC
    - cron: '13 19 * * *'  # 7:13 PM UTC
    - cron: '38 20 * * *'  # 8:38 PM UTC
    - cron: '56 22 * * *'  # 10:56 PM UTC
    - cron: '25 23 * * *'  # 11:25 PM UTC
  workflow_dispatch: # Allow manual trigger

# Grant write permissions to push commits
permissions:
  contents: write

jobs:
  auto-commit:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: Create Random Commits
        run: |
          # Array of meaningful commit messages
          commit_messages=(
            # Route & Navigation
            "Update route calculation algorithm"
            "Refactor stop data fetching logic"
            "Optimize route planning logic"
            "Add support for multi-leg journeys"
            "Improve transfer detection between lines"
            "Fix route direction display issues"
            "Add favorite routes feature"
            "Enhance route comparison functionality"
            "Update route color coding system"
            "Improve route filtering options"
            
            # Real-time Data & Predictions
            "Improve error handling for API requests"
            "Add caching for frequently accessed routes"
            "Fix timezone handling in schedule display"
            "Enhance real-time arrival predictions"
            "Update vehicle position tracking"
            "Improve prediction accuracy algorithm"
            "Add service alerts integration"
            "Fix delay calculation logic"
            "Update schedule data refresh rate"
            "Optimize API polling intervals"
            
            # Map & Visualization
            "Optimize map rendering performance"
            "Fix memory leak in map component"
            "Update map marker icons"
            "Improve map zoom controls"
            "Add custom map styling"
            "Fix map clustering for stops"
            "Enhance map interaction gestures"
            "Update transit line overlays"
            "Improve map loading performance"
            "Add dark mode for map view"
            
            # UI/UX Improvements
            "Improve loading state animations"
            "Add error boundary for map view"
            "Update color scheme for better contrast"
            "Improve mobile responsiveness"
            "Fix layout issues on small screens"
            "Add loading skeletons for better UX"
            "Update button styles and interactions"
            "Improve card component design"
            "Add smooth transitions between views"
            "Enhance notification system"
            
            # Search & Filters
            "Improve search functionality"
            "Add autocomplete for stop search"
            "Enhance filter performance"
            "Update search result ranking"
            "Add recent searches feature"
            "Improve fuzzy search algorithm"
            "Fix search input debouncing"
            "Add search suggestions"
            
            # Accessibility
            "Improve accessibility for screen readers"
            "Add keyboard navigation support"
            "Fix accessibility issues"
            "Enhance ARIA labels"
            "Improve focus management"
            "Add high contrast mode"
            "Update alt text for images"
            
            # Performance & Optimization
            "Optimize bundle size"
            "Improve animation performance"
            "Add performance monitoring"
            "Optimize image loading"
            "Reduce initial load time"
            "Implement code splitting"
            "Add lazy loading for routes"
            "Optimize re-render cycles"
            "Improve memory management"
            "Add service worker optimizations"
            
            # State Management
            "Refactor state management logic"
            "Add user preference persistence"
            "Improve local storage handling"
            "Update Redux store structure"
            "Add state synchronization"
            "Fix state mutation issues"
            
            # Error Handling & Validation
            "Improve network error handling"
            "Update error messages for clarity"
            "Improve data validation logic"
            "Add fallback for API failures"
            "Fix edge cases in route planning"
            "Add input validation"
            "Improve error recovery logic"
            
            # Testing & Quality
            "Add unit tests for route service"
            "Add integration tests"
            "Update test coverage"
            "Add E2E tests for critical flows"
            "Fix flaky tests"
            "Improve test performance"
            
            # Documentation & Code Quality
            "Update documentation for API endpoints"
            "Improve code documentation"
            "Update README documentation"
            "Improve code formatting"
            "Add JSDoc comments"
            "Update contributing guidelines"
            "Improve code organization"
            
            # Dependencies & Build
            "Update dependencies to latest versions"
            "Fix cross-browser compatibility issues"
            "Update build configuration"
            "Improve type definitions"
            "Add ESLint rules for consistency"
            "Update Webpack configuration"
            "Fix dependency vulnerabilities"
            
            # Features & Enhancements
            "Add analytics tracking events"
            "Refactor nearby stops calculation"
            "Improve geolocation accuracy"
            "Add offline functionality"
            "Update service worker cache strategy"
            "Add push notification support"
            "Implement trip planning feature"
            "Add schedule bookmarking"
            "Enhance location sharing"
            
            # Bug Fixes
            "Fix race condition in data fetching"
            "Fix timezone conversion bugs"
            "Fix scroll behavior on mobile"
            "Fix touch event handling"
            "Fix route display glitches"
            "Fix API response parsing errors"
            "Fix memory leaks in components"
            
            # Refactoring
            "Refactor component structure"
            "Refactor utility functions"
            "Update API response parsing"
            "Modernize codebase structure"
            "Simplify complex components"
            "Extract reusable hooks"
          )
          
          # Determine if we should create commits (70% chance to avoid too many commits)
          if [ $((RANDOM % 10)) -lt 7 ]; then
            # Random number of commits between 1 and 4 per run (total 1-15 per day across runs)
            num_commits=$((1 + RANDOM % 4))
            
            echo "Creating $num_commits commit(s)..."
            
            for ((i=1; i<=num_commits; i++)); do
              # Get random commit message
              random_index=$((RANDOM % ${#commit_messages[@]}))
              message="${commit_messages[$random_index]}"
              
              # Create empty commit with meaningful message
              git commit --allow-empty -m "$message"
              
              echo "✓ Created commit: $message"
              
              # Immediately push after each commit
              git push origin main
              echo "✓ Pushed commit to GitHub"
              
              # Random delay between commits (10-300 seconds)
              if [ $i -lt $num_commits ]; then
                sleep_time=$((10 + RANDOM % 290))
                echo "Waiting ${sleep_time} seconds before next commit..."
                sleep $sleep_time
              fi
            done
            
            echo "All commits created and pushed successfully!"
          else
            echo "Skipping commits this run to maintain natural activity pattern"
          fi
      
      - name: Verify Push
        run: |
          echo "Latest commits:"
          git log --oneline -n 5
